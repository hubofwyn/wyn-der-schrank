#!/usr/bin/env bash
# Git pre-push hook — mirrors CI gates locally.
# Install: bun run setup-hooks
# CI equivalent: .github/workflows/ci.yml
#
# Gates (same order as CI, run sequentially):
#   1. Typecheck      (tsc --build)
#   2. Zone Lint      (ESLint modules/ enforcement)
#   3. Dep Structure  (dependency-cruiser forbidden rules)
#   4. Tests          (vitest single run)
#   5. Format         (biome check)

set -euo pipefail

echo "──────────────────────────────────────────────"
echo "  pre-push: running CI simulation locally"
echo "──────────────────────────────────────────────"

echo ""
echo "▸ [1/5] Typecheck"
bun run typecheck

echo ""
echo "▸ [2/5] Zone Lint"
bun run lint:zones

echo ""
echo "▸ [3/5] Dependency Structure"
bun run deps:check

echo ""
echo "▸ [4/5] Tests"
bun run test:run

echo ""
echo "▸ [5/5] Format"
bun run format:check

echo ""
echo "──────────────────────────────────────────────"
echo "  ✓ All gates passed. Push proceeding."
echo "──────────────────────────────────────────────"
